<!doctype html>
<html>
	<head>

		<title>101 Concurrency</title>
		<link rel="shortcut icon" href="images/favicon.ico" />

		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="./reveal.js/dist/reset.css">
		<link rel="stylesheet" href="./reveal.js/dist/reveal.css">
		<link rel="stylesheet" href="./reveal.js/dist/theme/white.css" id="theme">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="./reveal.js/plugin/highlight/monokai.css" id="highlight-theme">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<section>
						<img src="images/duke-threads2.png" width="60%">
						<p>
							Detecting concurrency issues with JCStress<br />
							<small>Juan Antonio Bre√±a Moral</small>
						</p>
					</section>
					<section>
						<p>Follow the talk from your smartphone:</p>
						<img src="images/qrcode.png" width="40%" />
					</section>
					<section>
						<p>Example repository:</p>
						<a href="https://github.com/jabrena/101-concurrency" target="_blank">
							<img src="images/github.png" width="35%">
						</a>
						<p>
							<a href="https://github.com/jabrena/101-concurrency" target="_blank">
								https://github.com/jabrena/101-concurrency
							</a>
						</p>
					</section>
				</section>
				<section>
					<section>
						<h2>Agenda</h2>
						<ol>
							<li>Who I am</li>
							<li>Expectations</li>
							<li>Preamble</li>
							<li>Root causes</li>
							<!-- <li>Context</li> -->
							<!-- <li>Non funcional requirements</li> -->
							<!-- <li>Concurrency models</li> -->
							<!-- <li>Concurrency concepts</li> -->
							<!-- <li>Concurrency evolution in the JVM</li> -->
							<!-- <li>Design patterns that impacts you</li> -->
							<!-- <li>Other concurrency approaches</li> -->
							<li>Concurrency tools: JCStress</li>
							<li>Takeaways</li>
							<li>References</li>
							<li>Q&A</li>
						</ol>
					</section>
				</section>
				<section>
					<section>
						<h2>Who I am</h2>
						<h3>Juan Antonio Bre√±a Moral</h3>
						<table>
							<tr>
								<td>
									<img src="./images/jab-avatar.png" width="100%"/>
								</td>
								<td style="vertical-align: top">
									<!-- Computer Science and Engineering (B.S.) <br /> -->
									Engineering in Industrial Organization (M.S.) @ <span>ICAI</span> <br />
									Head of Developer Relations @ <span>Amadeus for developers</span> <br />
									Associate Professor @ <span>ICAI</span> <br />
									STEAM Teacher @ <span>Space Math</span> <br />
									<a target="_blank" style="text-decoration: underline;" href="https://twitter.com/juanantoniobm">@juanantoniobm</a> |
									<a target="_blank" style="text-decoration: underline;" href="https://github.com/jabrena">Github</a></li>
								</td>
							</tr>
						</table>
					</section>
				</section>
				<section>
					<section>
						<h2>Expectations</h2>
						<ul>
							<li>Generate curiosity about potential issues by concurrency.</li>
							<li>Understand better the Java Memory Model.</li>
							<li>Understand the evolution of concurrency in Java.</li>
							<li>Learn how to use JCStress in your projects</li>
						</ul>
						<h3 style="color:red">WIP</h3>
					</section>

					<!--
					https://www.baeldung.com/java-variable-handles
					-->
					<section>
						<h2>Expectations</h2>
						<p>
							The talk with not talk about:
						</p>
						<ul>
							<li><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/invoke/VarHandle.html" target="_blank">java.lang.invoke.VarHandle</a></li>
						</ul>
					</section>
				</section>
				<section>
					<h2>Disclaimer</h2>
					<img src="images/disclaimer.png" width="30%"/>
					<p>
						<strong>Note:</strong> I am not the author of JCStress <br/>
						(<a href="https://shipilev.net/" target="_blank">Aleksey Shipil√´v</a>), but I will do my best.
						<br/>üòä
					</p>
				</section>
				<section>
					<section>
						<h2>Preamble</h2>
						<p>
							Imagine a development with some Business requirements:
						</p>
						<!--
						https://cucumber.io/docs/gherkin/reference/
						-->
						<pre><code data-trim>
Feature: Sum 2 numbers

  Scenario: Sum 2 positive numbers
	&nbsp;&nbsp;Given the POST endpoint /api/v1/sum2numbers
	&nbsp;&nbsp;When the client send the request
	&nbsp;&nbsp;Then the response includes the sum of the 2 parameters
						</code></pre>
					</section>
					<section>
						<h2>Preamble</h2>
						<p>
							The code has a good Unit Tests:
						</p>
						<img src="images/test-report.png" width="100%"/>
					</section>
					<section>
						<h2>Preamble</h2>
						<p>
							The code has a good Code Coverage:
						</p>
						<img src="images/jacoco-report.png" width="100%"/>
					</section>
					<section>
						<h2>Preamble</h2>
						<p>
							The code has a good Mutation Coverage:
						</p>
						<img src="images/pitest-report.png" width="100%"/>
					</section>
					<section>
						<h2>Preamble</h2>
						<ul>
							<li>The code has a good Score in Sonar.</li>
							<li>The code doesn¬¥t have any Memory leak.</li>
							<li>The code has a good Throughput.</li>
							<li>The code has a good Pipeline support.</li>
						</ul>
					</section>
					<section>
						<h2>Preamble</h2>
						<p>
							But..., one day we receive an email from one User about unexpected results...
						</p>
						<img src="images/email.png" width="40%" />
					</section>
					<section>
						<h2>Preamble</h2>
						<img src="images/thinking1.jpg" width="50%" />
						<p>
							<strong>Developer:</strong> "Weird, everything is fine in my side..."
						</p>
					</section>
					<section>
						<h2>Preamble</h2>
						<img src="images/thinking3.png" width="40%" />
						<p>
							<strong>Developer:</strong> "...and using the data provided from the User,
							the new test doesn¬¥t reproduce the issue in my local dev environment."
						</p>
					</section>
					<section>
						<h2>Preamble</h2>
						<img src="images/thinking6.png" width="30%" />
						<p>
							<strong>Developer:</strong> "...maybe, I didn¬¥t read the <a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-17.html" target="_blank">JLS (Java Language Specification), section 17.4.</a> about <u>Concurrency</u>
							and the <a href="https://download.oracle.com/otndocs/jcp/memory_model-1.0-pfd-spec-oth-JSpec/" target="_blank">JSR 133</a>"
						</p>
					</section>
					<section>
						<h2>Preamble</h2>
						<img src="images/thinking5.png" width="35%" />
						<p>
							<strong>Developer:</strong> "...but now, we are in Production..."
						</p>
					</section>
					<section>
						<h2>Preamble</h2>
						<hr />
						<h3 style="color:green">
							Java is a multithreading & multiprocessing programming language
							and <u>Shared Memory</u> is the Inter-Process Communication (IPC) technique for Threads.
						</h3>
						<hr />
						<p>
							And every Java developer needs to know it.
						</p>
					</section>
				</section>
				<section>
					<section>
						<h2>Root causes</h2>
						<p>But..</p>
						<p>
							What do you think about possible root causes to generate Concurrency issues?
						</p>
						<img src="images/concurrency-issues.jpg" width="40%"/>
					</section>
					<section>
						<img src="images/survey.png"/>
					</section>
					<section>
						<p>
							<a href="https://pollev.com/juanantoniobrenamoral114" target="_blank">https://pollev.com/juanantoniobrenamoral114</a>
						</p>
					</section>
					<section>
						<h2>Root causes</h2>
						<p>I share some ideas about it:</p>
					</section>
					<section>
						<h2>Root causes</h2>
						<ul>
							<li>Engineering teams bad designed.</li>
							<li>Project bad estimated.</li>
							<li>Cognitive load issues.</li>
							<li>Lack of specialists about concurrency in your BU.</li>
							<li>Poliglot environments</li>
						</ul>
					</section>
					<section>
						<h2>Root causes</h2>
						<ul>
							<li>Lack of internal trainings about concurrency.</li>
							<li>Bad delegation of complex tasks.</li>
							<li>Projects with non-functional requirements well defined.</li>
							<li>Engineers more focused on cool features from Frameworks than language fundamentals.</li>
						</ul>
					</section>
					<section>
						<h2>Root causes</h2>
						<p>
							But if the developer doesn¬¥t handle the JMM concepts in a fluent way...
						</p>
						<img src="images/jmm-1.png" width="70%"/>
					</section>
					<section>
						<h2>Root causes</h2>
						<p>
							the party could begin in any moment...
						</p>
						<img src="images/lemmings.png" width="50%"/>
					</section>
				</section>
				<!--
				<section>
					<section>
						<h2>Context</h2>
						<ul>
							<li>In many cases, non funcional requirements are not well defined.</li>
							<li>If the team are using some kind of "Agile flavour", the definition of Done, doesnt¬¥t define aspects about non funcional requirements.</li>
							<li>The Java programming language has included Multithreading features since 1996 (Java 1.0).</li>
						</ul>
					</section>
					<section>
						<h2>Context</h2>
						<ul>
							<li>Not all Java developers understand how to program thread-safety code.</li>
							<li>Handling shared memory is the main approach in Java but it is not the unique approach.</li>
							<li>Is it still valid the term: "Write once, run everywhere"? (When you deploy multithreading code in production).</li>
						</ul>
					</section>
					<! --
					<section>
						<img src="images/quiz.png" width="50%"/>
					</section>
					<section>
						<h2>Context</h2>
						<h4>Question: What is the java version used in production?</h4>
						<p>
							<a href="https://pollev.com/juanantoniobrenamoral114" target="_blank">https://pollev.com/juanantoniobrenamoral114</a>
						</p>
					</section>
					<section>
						<h2>Context</h2>
						<h4>Question: Did all your team members read "Concurrent Programming in Java" or "Java concurrency in practice" at least once?</h4>
						<p>
							<a href="https://pollev.com/juanantoniobrenamoral114" target="_blank">https://pollev.com/juanantoniobrenamoral114</a>
						</p>
						<img src="images/book-java-concurrency-in-practice.jpg" width="24%" />&nbsp;
						<img src="images/book-concurrent-programming-in-java.jpg" width="25%" />
					</section>
					<section>
						<h2>Context</h2>
						<h4>Question: Did you face in the past a Concurrency issue?</h4>
						<p>
							<a href="https://pollev.com/juanantoniobrenamoral114" target="_blank">https://pollev.com/juanantoniobrenamoral114</a>
						</p>
					</section>
					<section>
						<h2>Context</h2>
						<h4>Question: What kind of concurrency objects or language resources, do you use in your daily job?</h4>
						<p>
							<a href="https://pollev.com/juanantoniobrenamoral114" target="_blank">https://pollev.com/juanantoniobrenamoral114</a>
						</p>
					</section>
					-- >
				</section>
				-->
				<section>
					<section>
						<h2>Root causes</h2>
						<h4>Non funcional requirements</h4>
						<p>
							Do you define properly the non functional requirements in your projects?
						</p>
						<img src="images/iceberg.png" width="50%"/>
					</section>
					<section>
						<h2>Root causes</h2>
						<h4>Non funcional requirements</h4>
						<p>
							Do you know that exist an ISO Standard for Software Quality aspects?
						</p>
					</section>
					<section>
						<h2>Root causes</h2>
						<h4>Non funcional requirements</h4>
						<h5>ISO 25010</h5>
						<p>
							ISO 25010, titled ‚ÄúSystem and software quality models‚Äù, is a software quality standard.
							It describes the models, consisting of characteristics and sub-characteristics,
							for both software product quality, and software quality in use together with practical
							guidance on the use of the quality models.
						</p>
						<small><strong>Source:</strong>
							<a href="https://iso25000.com/index.php/en/iso-25000-standards/iso-25010" target="_blank">
								https://iso25000.com/index.php/en/iso-25000-standards/iso-25010</a>
						</small>
					</section>
					<section>
						<h2>Root causes</h2>
						<h4>Non funcional requirements</h4>
						<h5>ISO 25010</h5>
						<img src="images/iso-25010.png" />
						<br />
						<small><strong>Source:</strong>
							<a href="https://iso25000.com/index.php/en/iso-25000-standards/iso-25010" target="_blank">
								https://iso25000.com/index.php/en/iso-25000-standards/iso-25010</a>
						</small>
					</section>
					<section>
						<h2>Root causes</h2>
						<h4>Non funcional requirements</h4>
						<h5>ISO 25010</h5>
						<ul>
							<li>Functional Suitability</li>
							<li>Performance efficiency</li>
							<li>Compatibility</li>
							<li>Usability</li>
							<li>Reliability</li>
							<li>Security</li>
							<li>Maintainability</li>
							<li>Portability</li>
						</ul>
					</section>
					<section>
						<h2>Root causes</h2>
						<h4>Non funcional requirements</h4>
						<h5>ISO 25010</h5>
						<strong>Functional Suitability</strong>
						<p>
						This characteristic represents the degree to which a product or system provides functions
						that meet stated and implied needs when used under specified conditions.
						</p>
					</section>
					<section>
						<h2>Root causes</h2>
						<h4>Non funcional requirements</h4>
						<h5>ISO 25010</h5>
						<strong>Functional Suitability</strong>
						<p>
							This characteristic is composed of the following sub-characteristics:
						</p>
						<small>
							<ul>
								<li>Functional completeness - Degree to which the set of functions covers all the specified tasks and user objectives.</li>
								<li><u>Functional correctness - Degree to which a product or system provides the correct results with the needed degree of precision.</u></li>
								<li>Functional appropriateness - Degree to which the functions facilitate the accomplishment of specified tasks and objectives.</li>
							</ul>
						</small>
					</section>
					<section>
						<h2>Root causes</h2>
						<h4>Non funcional requirements</h4>
						<h5>ISO 25010</h5>
						<p>
							Functional correctness - Degree to which a product or system provides the correct results with the needed degree of precision.
						</p>
					</section>
					<section>
						<h2>Root causes</h2>
						<p>
							"At the heart of any reasonable definition of thread safety is the concept of
							correctness. If our definition of thread safety is fuzzy, it is because we lack a clear
							definition of correctness.
							Correctness means that a class conforms to its specification. A good specification
							defines invariants constraining an object‚Äôs state and postconditions describing the
							effects of its operations."
						</p>
						- <a href="https://jcip.net/" target="_blank">Brian Goetz, Java Concurrency in Practice, 2006</a>
					</section>
				</section>
				<!--
				<section>
					<section>
						<h2>Concurrency concepts</h2>
						<ul>
							<li>Concurrency & Parallelism</li>
							<li>Amdahl's law</li>
							<li>Cache coherency</li>
							<li>JMM, Java memory model</li>
						</ul>
					</section>
					<section>
						<h2>Concurrency concepts</h2>
						<h4>Concurrency & Parallelism</h4>
						<img src="images/concurrency-parallelism.png" width="70%" />
					</section>
					<section>
						<h2>Concurrency concepts</h2>
						<h4>Amdahl's law</h4>
						<p>
							Amdahl's law is a formula which gives the theoretical speedup in latency
							of the execution of a task at fixed workload that can be expected of
							a system whose resources are improved.
							Specifically, it states that "the overall performance improvement gained by optimizing
							a single part of a system is limited by the fraction of time that the improved part
							is actually used".
						</p>
						<a href="https://en.wikipedia.org/wiki/Amdahl%27s_law" target="_blank">https://en.wikipedia.org/wiki/Amdahl%27s_law</a>
					</section>
					-->
					<!--
					http://www.cs.umd.edu/~pugh/java/memoryModel/Dagstuhl.pdf
					https://chowdera.com/2022/04/202204030513095225.html
					https://www.cs.umd.edu/~pugh/java/memoryModel/jsr133.pdf
					https://www.slideshare.net/instinctools_EE_Labs/java-memory-model-66558368
					https://shipilev.net/talks/geecon-May2018-jmm.pdf
					https://shipilev.net/blog/2014/safe-public-construction/
					https://shipilev.net/blog/2014/jmm-pragmatics/
					https://shipilev.net/talks/narnia-2555-jmm-pragmatics-en.pdf
					https://shipilev.net/blog/2016/close-encounters-of-jmm-kind/
					-->
					<!--
					<section>
						<h2>Concurrency concepts</h2>
						<h4>JMM, Java memory model</h4>
						<p>
							Defines the semantics of multithreaded programs
						</p>
						<p>
							The Java memory model describes how threads in the Java programming language
							interact through memory. Together with the description of single-threaded execution of code,
							the memory model provides the semantics of the Java programming language.
						</p>
						<a href="https://en.wikipedia.org/wiki/Java_memory_model" target="_blank">https://en.wikipedia.org/wiki/Java_memory_model</a>
					</section>
					<section>
						<h2>Concurrency concepts</h2>
						<h4>JMM, Java memory model</h4>
						<ul>
							<li>Modern hardware architecture</li>
							<li>How JVM interacts with hardware</li>
							<li>What is shared memory?</li>
						</ul>
					</section>
					<section>
						<h2>Concurrency concepts</h2>
						<h4>JMM, Java memory model</h4>
						<ul>
							<li>Atomicity:
								Which instructions must have indivisible effects.
								For purposes of the model, these rules need to be stated only for simple reads
								and writes of memory cells representing fields - instance and static variables,
								also including array elements, but not including local variables inside methods.</li>
							<li>Visibility:
								Under what conditions the effects of one thread are visible to another.
								The effects of interest here are writes to fields, as seen via reads of those fields.</li>
							<li>Ordering:
								Under what conditions the effects of operations can appear out of order
								to any given thread. The main ordering issues surround reads and writes associated
								with sequences of assignment statements.</li>

						</ul>
					</section>
					<section>
						<h2>Concurrency concepts</h2>
						<h4>JMM, Java memory model</h4>
						<img src="images/jmm-1.png" width="70%" />
					</section>
					<section>
						<h2>Concurrency concepts</h2>
						<h4>JMM, Java memory model</h4>
						<img src="images/jmm-2.png" width="70%" />
					</section>
				</section>
				-->
				<section>
					<section>
						<h2>Root causes</h2>
						<h4>Concurrency models</h4>
						<img src="images/lang-rank-0122.png" width="50%">
						<br />
						<small><strong>Source:</strong>
							<a href="https://redmonk.com/sogrady/2022/03/28/language-rankings-1-22/" target="_blank">
								https://redmonk.com/sogrady/2022/03/28/language-rankings-1-22/</a>
						</small>
					</section>
					<section>
						<h2>Root causes</h2>
						<h4>Concurrency models</h4>
						<p>
							Every programming language implement different approaches about Concurrency
							and not all of them are in the same stage.
						</p>
						<p>
							That detail is important when you apply "T-shaped" strategies.
						</p>
					</section>
					<!--
					https://www.baeldung.com/java-thread-lifecycle
					https://dzone.com/articles/java-concurrency-evolution
					-->
					<section>
						<h2>Root causes</h2>
						<h4>Concurrency models</h4>
						<p>
							How Concurrency evolves in Java:
						</p>
						<small>
							<table>
								<tr>
									<th>Java version</th>
									<th>Key features</th>
									<th>Release data</th>
								</tr>
								<tr>
									<td>Java 1.0</td>
									<td>Java OS Threads</td>
									<td>23/01/1996</td>
								</tr>
								<tr>
									<td>Java 1.5</td>
									<td>JSR 133, java.util.concurrent.*</td>
									<td>30/09/2004</td>
								</tr>
								<tr>
									<td>Java 1.7</td>
									<td>Fork/join framework</td>
									<td>07/07/2011</td>
								</tr>
								<tr>
									<td>Java 1.8</td>
									<td>CompletableFuture</td>
									<td>18/03/2014</td>
								</tr>
								<tr>
									<td>Java 19</td>
									<td>Virtual Threads, Structured Concurrency</td>
									<td>20/09/2022</td>
								</tr>
							</table>
						</small>
					</section>
					<!--
					<section>
						<h2>Concurrency models & evolution</h2>
						<h3>Java 1.0 / Java Threads (23/01/1996)</h3>
						<ul>
							<li>PENDING</li>
							<li>PENDING</li>
							<li>PENDING</li>
							<li>PENDING</li>
						</ul>
					</section>
					<section>
						<h2>Concurrency evolution in the JVM</h2>
						<h3>Java 1.0 / Java Threads (23/01/1996)</h3>
						<img src="images/thread-life-cycle.jpg" width="50%"/>
					</section>
					<section>
						<h2>Concurrency models & evolution</h2>
						<h3>Java 1.0 / Java Threads (23/01/1996)</h3>
						<img src="images/os-threads.png" width="70%"/>
					</section>
					<section>
						<h2>Concurrency models & evolution</h2>
						<h3>Java 1.0 / Java Threads (23/01/1996)</h3>
						<pre><code data-trim>
class Process implements Runnable {
    public void run() {
        System.out.println("Thread is running...");
    }
}
public class ThreadBasic {
    public static void main(String args[]) throws InterruptedException {
        Process m1 = new Process();
        Thread t1 =new Thread(m1);
        t1.start();
        t1.join();
        System.out.println("Example finished");
    }
}

						</code></pre>
					</section>
					<section>
						<h2>Concurrency models & evolution</h2>
						<h3>Java 1.0 / Java Threads (23/01/1996)</h3>
						<pre><code data-trim>
Thread is running...
Example finished
						</code></pre>
					</section>
					<section>
						<h2>Concurrency models & evolution</h2>
						<h3>Java 1.0 / Java Threads (23/01/1996)</h3>
						<p>
							Javadocs:
						</p>
						<ul>
							<li><a href="http://web.archive.org/web/19990202194011/http://java.sun.com/products/jdk/1.0.2/api/" target="_blank">Java 1.0.2 Javadocs</a> (Web Archive)</li>
							<li><a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html" target="_blank">Thread</a> </li>
							<li><a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Runnable.html" target="_blank">Runnable</a> </li>
						</ul>
					</section>
					<! --
					https://en.wikipedia.org/wiki/Java_memory_model
					https://jenkov.com/tutorials/java-concurrency/java-memory-model.html
					-- >
					<section>
						<h2>Concurrency models & evolution</h2>
						<h3>Java 1.5 / JSR 133, java.util.concurrent.* (30/09/2004)</h3>
						<ul>
							<li>PENDING</li>
							<li>PENDING</li>
							<li>PENDING</li>
							<li>PENDING</li>
						</ul>
					</section>
					<section>
						<h2>Concurrency models & evolution</h2>
						<h3>Java 1.5 / JSR 133, java.util.concurrent.* (30/09/2004)</h3>
						<img src="images/java-memory-model-4.png" width="40%"/>
					</section>
					<section>
						<h2>Concurrency models & evolution</h2>
						<h3>Java 1.5 / JSR 133, java.util.concurrent.* (30/09/2004)</h3>
						<img src="images/java-memory-model-3.png" width="40%"/>
					</section>
					<section>
						<h2>Concurrency models & evolution</h2>
						<h3>Java 1.5 / JSR 133, java.util.concurrent.* (30/09/2004)</h3>
						<img src="images/executor-service.jpg" width="60%"/>
					</section>
					<section>
						<h2>Concurrency models & evolution</h2>
						<! -- <h3>Java 1.5 / JSR 133, java.util.concurrent.* (30/09/2004)</h3> -- >
						<pre><code data-trim>
public class ExecutorServiceBasic {
    private static CountDownLatch latch = new CountDownLatch(1);
    public static void main(String args[]) throws InterruptedException {
        ExecutorService executor = Executors.newFixedThreadPool(2);
        executor.submit(new Process2());
        latch.await();
        executor.shutdown();
        executor.awaitTermination(60, TimeUnit.SECONDS);
        System.out.println("Example finished");
    }
    static class Process2 implements Runnable {
        public void run() {
            System.out.println("Thread is running...");
            latch.countDown();
        }
    }
}

						</code></pre>
					</section>
					<section>
						<h2>Concurrency models & evolution</h2>
						<h3>Java 1.5 / JSR 133, java.util.concurrent.* (30/09/2004)</h3>
						<pre><code data-trim>
Thread is running...
Example finished
						</code></pre>
					</section>
					<section>
						<h2>Concurrency models & evolution</h2>
						<! -- <h3>Java 1.5 / JSR 133, java.util.concurrent.* (30/09/2004)</h3>-- >
						<p>
							References:
						</p>
						<ul>
							<li><a href="https://docs.oracle.com/javase/1.5.0/docs/api/" target="_blank">Java 1.5.0 Javadocs</a></li>
							<li><a href="https://download.oracle.com/otndocs/jcp/memory_model-1.0-pfd-spec-oth-JSpec/" target="_blank">JSR-133 Java Memory Model and Thread Specification 1.0</a> </li>
							<li><a href="https://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/ExecutorService.html" target="_blank">ExecutorService</a></li>
							<li><a href="https://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/Future.html" target="_blank">Future</a></li>
							<li><a href="https://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/atomic/package-summary.html">Package java.util.concurrent.atomic</a></li>
							<li><a href="https://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/locks/package-summary.html">Package java.util.concurrent.locks</a> </li>
						</ul>
					</section>
					<section>
						<h2>Concurrency models & evolution</h2>
						<h3>Java 1.7 / Fork/join framework (07/07/2011)</h3>
						<ul>
							<li>PENDING</li>
							<li>PENDING</li>
							<li>PENDING</li>
							<li>PENDING</li>
						</ul>
					</section>
					<! --
					http://rashidnoorani.blogspot.com/2012/08/how-to-use-fork-join-framework-features.html
					https://github.com/bejancsaba/java-concurrency-evolution
					https://github.com/bejancsaba/java-concurrency-evolution-loom
					-- >
					<section>
						<h2>Concurrency models & evolution</h2>
						<h3>Java 1.8 / CompletableFuture (18/03/2014)</h3>
						<ul>
							<li>PENDING</li>
							<li>PENDING</li>
							<li>PENDING</li>
							<li>PENDING</li>
						</ul>
					</section>
					<section>
						<h2>Concurrency models & evolution</h2>
						<h3>Java 19 / Virtual Threads, Structured Concurrency (20/09/2022)</h3>
						<ul>
							<li>PENDING</li>
							<li>PENDING</li>
							<li>PENDING</li>
							<li>PENDING</li>
						</ul>
					</section>
					-->
				</section>
				<section>
					<section>
						<h2>Root causes</h2>
						<h4>Design patterns that impacts you</h4>
						<ul>
							<li>CDI, Contexts and Dependency Injection</li>
						</ul>
						<img src="images/spring-container.png" width="50%" />
					</section>
					<section>
						<h2>Root causes</h2>
						<h4>Design patterns that impacts you</h4>
						<p>
							CDI (Contexts and Dependency Injection) is a standard
							dependency injection framework included in Jakarta EE.
							It allows us to manage the lifecycle of
							stateful components via domain-specific lifecycle
							contexts and inject components (services) into client
							objects in a type-safe way.
						</p>
					</section>
				</section>
				<!--
				https://github.com/awspring/spring-cloud-aws/search?l=Java&q=%22synchronized+%28this.%22
				https://github.com/search?l=Java&q=org%3Aspring-projects+%22import+java.util.concurrent.locks.%22&type=Code
				https://github.com/search?l=Java&q=org%3Aspring-projects+%22volatile+%22&type=Code
				https://github.com/search?l=Java&q=org%3Aspring-projects+%22synchronized+%28this%22&type=Code
				https://github.com/search?l=Java&q=org%3Aquarkusio+%22volatile+%22&type=Code
				https://github.com/search?q=org%3Aquarkusio+%22synchronized+%28this%22&type=code
				https://github.com/search?q=org%3Aquarkusio+%22import+java.util.concurrent.locks.%22&type=code
				https://github.com/search?l=Java&q=org%3Amicronaut-projects+%22import+java.util.concurrent.locks.%22&type=Code
				https://github.com/search?q=org%3Amicronaut-projects+%22synchronized+%28this%22&type=code
				https://github.com/search?l=Java&q=org%3Amicronaut-projects+%22volatile+%22&type=Code
				https://github.com/search?q=org%3Areactor+jcstress&type=code
				https://github.com/reactor/reactor-core/blob/main/reactor-core/src/jcstress/java/reactor/util/concurrent/MpscLinkedQueueStressTest.java
				https://github.com/reactor/reactor-core/blob/main/reactor-core/src/test/java/reactor/util/concurrent/MpscLinkedQueueTest.java
				https://github.com/reactor/reactor-core/blob/main/reactor-core/src/main/java/reactor/util/concurrent/MpscLinkedQueue.java
				-->
				<!--
				https://foojay.io/today/jcstress/
				https://www.baeldung.com/java-testing-multithreaded#4-java-jcstress
				https://shipilev.net/talks/geecon-May2018-jmm.pdf
				https://shipilev.net/blog/2014/jmm-pragmatics/#_preface
				https://shipilev.net/talks/narnia-2555-jmm-pragmatics-en.pdf
				https://shipilev.net/blog/2016/close-encounters-of-jmm-kind/

				./gradlew clean jcstress --tests "Calculator5Test"
				-->
				<section>
					<section>
						<h2>Concurrency tools: JCStress</h2>
						<ul>
							<li>Introduction</li>
							<!-- <li>Who is behind the library?</li> -->
							<li>What are the benefits?</li>
							<li>Creating your first JCStress test</li>
							<li>Does exist plugins?</li>
							<li>What projects are using the JCStress?</li>
							<li>Limitations</li>
						</ul>
					</section>
					<section>
						<h2>Concurrency tools: JCStress</h2>
						<h3>Introduction</h3>
						<p>
							The Java Concurrency Stress (jcstress) is the experimental harness and
							a suite of tests to aid the research in the correctness of concurrency support
							in the JVM, class libraries, and hardware.
						</p>
						<a href="https://github.com/openjdk/jcstress" target="_blank">https://github.com/openjdk/jcstress</a>
					</section>
					<!--
					<section>
						<h2>Concurrency tools: JCStress</h2>
						<h3>Who is behind the library?</h3>
						<p>
							Aleksey Shipil√´v is working on Java performance for 10+ years.
							Today he is employed by Red Hat, where he does OpenJDK development and performance work.
							Aleksey develops and maintains a number of OpenJDK subprojects,
							including
							<a href="https://github.com/openjdk/jmh" target="_blank">JMH</a>,
							<a href="https://github.com/openjdk/jol" target="_blank">JOL</a> and
							<a href="https://github.com/openjdk/jcstress" target="_blank">JCStress</a>.
						</p>
						<a href="https://shipilev.net/" target="_blank">https://shipilev.net/</a>
					</section>
					-->
					<section>
						<h2>Concurrency tools: JCStress</h2>
						<h3>What are the benefits?</h3>
						<ul>
							<li>Increase the capacity to test for concurrency in your Java classes
								that you know that the class is sharing state.</li>
						</ul>
					</section>
					<section>
						<h2>Concurrency tools: JCStress</h2>
						<h4>Creating your first JCStress test</h4>
						<ul>
							<li>Review in your project, classes where the team consider that it is necessary to maintaing the state.</li>
							<li>Review what Java concurrency tools are more suitable for the problem.</li>
						</ul>
					</section>
					<section>
						<h2>Concurrency tools: JCStress</h2>
						<h4>Creating your first JCStress test</h4>
						<p>
							In Java, you could use:
						</p>
						<ul>
							<li>volatile</li>
							<li>Locks</li>
							<li>Atomic objects</li>
						</ul>
					</section>
					<section>
						<h2>Concurrency tools: JCStress</h2>
						<h4>Creating your first JCStress test</h4>
						<p>
							There are 3 main issues with multithreading:
						</p>
						<ol>
							<li>Atomicity</li>
							<li>Visibility</li>
							<li>Reordering</li>
						</ol>
					</section>
					<!--
					https://www.javacodegeeks.com/2014/08/java-concurrency-tutorial-atomicity-and-race-conditions.html
					-->
					<section>
						<h2>Concurrency tools: JCStress</h2>
						<h4>Creating your first JCStress test</h4>
						<ul>
							<li>Atomicity / Race Conditions: Atomicity is one of the key concepts in multi-threaded programs. We say a set of actions is atomic if they all execute as a single operation, in an indivisible manner.</li>
						</ul>
						<p>
							Check-then-act
							Read-modify-write
						</p>
					</section>
					<section>
						<h2>Concurrency tools: JCStress</h2>
						<h4>Creating your first JCStress test</h4>
						<p>
							Atomicity / Race Conditions:
						</p>
						<img src="images/jmm-1.png" width="50%"/>
					</section>
					<section>
						<h2>Concurrency tools: JCStress</h2>
						<h4>Creating your first JCStress test</h4>
						<ul>
							<li>Visibility / Caching / stale memory : which means ensuring that a change to a shared variable made by one thread is visible to the rest of the thread.</li>
						</ul>
					</section>
					<!--
					https://jenkov.com/tutorials/java-concurrency/java-happens-before-guarantee.html
					-->
					<section>
						<h2>Concurrency tools: JCStress</h2>
						<h4>Creating your first JCStress test</h4>
						<ul>
							<li>Reordering / Compiler and CPU optimisations: The JVM could change the order of executions.</li>
						</ul>
					</section>
					<section>
						<h2>Concurrency tools: JCStress</h2>
						<h4>Creating your first JCStress test</h4>
						<ol>
							<li>Atomicity</li>
							<li>Visibility</li>
							<li>Reordering</li>
						</ol>
						<p>
							<strong>volatile</strong> can solve 2 & 3, but can't solve 1. <strong>synchronized/explicit locks</strong> can solve 1, 2 & 3.
						</p>
						<small>
							<strong>Source:</strong> <a href="https://stackoverflow.com/questions/3519664/difference-between-volatile-and-synchronized-in-java" target="_blank">Stack Overflow</a>
						</small>
					</section>
					<section>
						<h2>Concurrency tools: JCStress</h2>
						<h4>Creating your first JCStress test</h4>
						<pre><code data-trim>
./gradlew clean jcstress --tests "Example_01"
./gradlew clean jcstress --tests "Example_02"
						</code></pre>
						<img src="images/demo.png" width="60%" />
					</section>
					<section>
						<h2>Concurrency tools: JCStress</h2>
						<h4>Creating your first JCStress test</h4>
						<pre><code data-trim>
./gradlew clean jcstress --tests "Example_01"

RESULT      SAMPLES     FREQ       EXPECT  DESCRIPTION
1, 1   67,175,767   12.75%  Interesting  Both actors came up with the same value: atomicity failure.
1, 2  230,619,181   43.76%   Acceptable  actor1 incremented, then actor2.
2, 1  229,163,644   43.49%   Acceptable  actor2 incremented, then actor1.

./gradlew clean jcstress --tests "Example_02"

RESULT      SAMPLES     FREQ       EXPECT  DESCRIPTION
1, 1   50,158,990   11.27%  Interesting  Both actors came up with the same value: atomicity failure.
1, 2  198,225,259   44.55%   Acceptable  actor1 incremented, then actor2.
2, 1  196,592,903   44.18%   Acceptable  actor2 incremented, then actor1.
						</code></pre>
					</section>
					<section>
						<h2>Concurrency tools: JCStress</h2>
						<h4>Creating your first JCStress test</h4>
						<p>
							Fixing the first issue:
						</p>
						<pre><code data-trim>
./gradlew clean jcstress --tests "Example_03"
./gradlew clean jcstress --tests "Example_04"
./gradlew clean jcstress --tests "Example_05"
						</code></pre>
						<img src="images/demo.png" width="60%" />
					</section>
					<section>
						<h2>Concurrency tools: JCStress</h2>
						<h4>Creating your first JCStress test</h4>
						<pre><code data-trim>
@JCStressTest : Annotation which allow executing the class
@Outcome : Annotation to define expected results
@State : The class annotated with state will store the object state
@Actor : The elements which run the
@Result
						</code></pre>
					</section>
					<section>
						<h2>Concurrency tools: JCStress</h2>
						<ul>
							<li>I:  int</li>
							<li>Z:  boolean</li>
							<li>F:  float</li>
							<li>J:  long</li>
							<li>S:  short</li>
							<li>B:  byte</li>
							<li>C:  char</li>
							<li>D:  double</li>
							<li>L:  object</li>
						</ul>
					</section>
					<section>
						<h2>Concurrency tools: JCStress</h2>
						<h3 style="color:red">WIP</h3>
					</section>
				</section>
				<section>
					<h2>Takeaways</h2>
					<h3 style="color:red">WIP</h3>
				</section>
				<section>
					<section>
						<h2>References</h2>
						<ul>
							<li>https://docs.oracle.com/javase/specs/jls/se8/html/jls-17.html</li>
							<li>http://www.cs.umd.edu/~pugh/java/memoryModel/jsr-133-faq.html</li>
							<li>https://web.archive.org/web/20220601003130/http://gee.cs.oswego.edu/dl/jmm/cookbook.html</li>
							<li>https://web.archive.org/web/20220601003130/http://gee.cs.oswego.edu/dl/html/j9mm.html</li>
							<li>https://download.oracle.com/otndocs/jcp/memory_model-1.0-pfd-spec-oth-JSpec/</li>
							<li>https://openjdk.org/jeps/193</li>
						</ul>
					</section>
				</section>
				<section>
					<section>
						<img src="images/summary.png" width="50%">
					</section>
				</section>
				<section>
					<section>
						<h2>Q&A</h2>
					</section>
				</section>
			</div>
		</div>

		<script src="./reveal.js/dist/reveal.js"></script>
		<script src="./reveal.js/plugin/notes/notes.js"></script>
		<script src="./reveal.js/plugin/markdown/markdown.js"></script>
		<script src="./reveal.js/plugin/highlight/highlight.js"></script>

		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
